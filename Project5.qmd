---
title: "Multiple Logistic Regression: Types of Stress and Outcome of In Vitro Fertilization Treatment in Infertile Women"
author: "Obehi Winnifred Ikpea"
date: today
format:
  html:
    theme: cosmo
    css: style.css
    toc: true
    toc-depth: 2
    toc-title: "Contents"
    number-sections: true
    number-depth: 1
    highlight-style: github
    code-fold: true
    self-contained: true
    cite-method: citeproc
    bibliography-heading: References
    smooth-scroll: true
    anchor-sections: true
    fig-cap-location: bottom
    crossref:
      appendix-title: "Appendix"
      appendix-delim: ":"
execute:
  echo: false
  warning: false
  message: false
  cache: true
bibliography: references1.bib
csl: apa.csl
---

```{r echo=FALSE}
library(plotly)
library(tidyverse)
library(dplyr)
library(readr)
library(rigr)
library(gtsummary)
library(ggplot2)
library(readr)
library(readxl)
library(tidyr)
library(cowplot)
library(naniar)
library(mice)
library(visdat)
library(gt)
library(car)
library(performance)
library(vcd)
library(sjPlot)
library(GGally)
library(MASS)
library(knitr)
library(janitor)
ivf_data<- read_excel("Research Raw Data.xlsx",.name_repair = "universal" )[,-1]
```

# Introduction

According to the World Health Organization, estimates suggest that approximately one in every six people of reproductive age worldwide experiences infertility in their lifetime. Infertility is a disease of the male or female reproductive system defined by the failure to achieve a pregnancy after 12 months or more of regular unprotected sexual intercourse. This disease is caused by a number of different factors in either of the reproductive systems. In addition to these causes, lifestyle factors like smoking, excessive alcohol intake and obesity, and exposure to environmental pollutants and toxins can affect fertility [@who2020infertility]. There are different treatments for infertility; an example is the In Vitro Fertilization (IVF), a complex series of procedures that leads to pregnancy. The IVF procedure is the most effective type of fertility treatment that involves the handling of eggs or embryos and sperm. Although the treatment is effective, it raises the chances of certain health problems like stress, as the treatment can be draining for the body, mind, and finances [@mayoclinic2023ivf].

Stress is the state of worry or mental tension caused by a difficult situation. It is a natural human response that prompts us to address challenges and threats in our lives [@who2023stress]. Stress can be categorized into acute stress, chronic stress, and perceived stress. Acute stress is short-term stress that comes and goes quickly, and can be positive or negative. Acute stress can be measured using the State-Trait Anxiety Inventory, a commonly used measure of trait and state anxiety developed in 1970 to diagnose anxiety and distinguish it from depressive syndromes. High scores indicate high anxiety levels, and low scores indicate low anxiety levels [@apa2011stai] [@sciencedirect2024stai]. Chronic stress is long-term stress that goes on for a long duration of time [@clevelandclinic2024stress]. Chronic stress can be measured by the Social Readjustment Rating Scale, a tool developed in 1967 to measure the amount of stress a person has experienced recently [@mindtools2023holmes]. It is an inventory of the most common life stressors but can be difficult to interpret due to differences in individual coping abilities [@srrs].

Perceived stress refers to the feelings or thoughts that an individual has about how much stress they are under at a given point in time or over a given time period [@phillips2013perceivedstress]. Perceived stress is measured by the Perceived Stress Scale, the most widely used psychological instrument for measuring the perception of stress. It is a measure of the degree to which situations in one's life are appraised as stressful [@cohen1994perceived]. Stress affects the body physically with symptoms like chest pain, headaches, weakened immune system, and high blood pressure; psychologically with symptoms like anxiety, depression, and panic attacks; and behaviorally with symptoms like smoking, overeating, and alcohol use disorder [@clevelandclinic2024stress].

Studies show that acute

### Aim

The aim of this project is to investigate the association between specific types of stress (Acute, Chronic, and Perceived) and the outcome of pregnancy after IVF for a population of infertile women, while accounting for age and history of mental illness as potential confounders. Through this project, we would like to gain insight into how psychological factors like stress can influence physical outcomes in reproductive health.

#### Scientific Objectives

The following scientific objectives will be considered:

-   To investigate the association between pregnancy outcome after IVF and chronic stress, measured by the Social Readjustment Rating Scale (SRRS), adjusting for age , and history of mental illness.

-   To investigate the association between pregnancy outcome after IVF and acute stress, measured by the Spielberger Trait-State Anxiety Inventory (STAI), adjusting for age, and history of mental illness.

-   To investigate the association between pregnancy outcome after IVF and perceived stress, measured by the Perceived Stress Scale (PSS), adjusting for age, and history of mental illness.

# Data Description

The data comes from a prospective study examining the relationship between various types of stress and the outcome of In Vitro Fertilization (IVF) Treatment in Infertile Women. It comprises of 172 participants and 12 measurements, namely:

1.  **Binary indicators for:**

    -   Successful pregnancy

    -   Cause of infertility

    -   History of successful implantation

    -   History of abortion

    -   History of mental illness

    -   History of thyroid problems and diabetes

2.  **Stress measurements:**

    -   Chronic stress: measured by the Social Readjustment Rating Scale (SRRS)

    -   Acute stress: measured by the Spielberger State-Trait Anxiety Inventory (STAI)

    -   Perceived stress: measured by the Perceived Stress Scale (PSS)

3.  **Demographic and medical history:**

    -   Age (in years)

    -   Education (in years)

    -   Infertility period (in years)

# Methods

## Data Preprocessing

The dataset was tidied to ensure completeness and correctness before multiple analyses were implemented. This process involved:

-   Recoding the values of the categorical variables to their specific labels and changing the data types of specific variables.

```{r echo=FALSE}
ivf_data<-ivf_data|>dplyr::select(pregnancy=Successful.pregnancy...0..Unsuccessful.pregnancy...1, Chronic_Stress=Chronic.stress...Social.Readjustment.Rating.Scale..SRRS., Acute_stress=Acute.stress...Spielberger.Trait.State.Anxiety.Questionnaire..STAI., Perceived_stress=Perceived.stress...Perceived.Stress.Scale..PSS., Age=Age..year., mental_illness=History.of.mental.illness...No.history...0..With.history...1, everything(), infertility_period=Infertility.period..year...)

pregnancy_data<-ivf_data
pregnancy_data$pregnancy<-if_else(pregnancy_data$pregnancy==1, "Successful", 'Unsucessful')
pregnancy_data$mental_illness<-if_else(pregnancy_data$mental_illness==1, "History", 'No History')
```

## Exploratory Data Analysis

Exploratory analysis was implemented on the dataset to identify errors and anomalies, understand the distribution of the variables, and gain visual and numeric insights into the associations between the outcome and predictor variables. This method was carried out in various stages:

-   A summary statistics table was generated to present summary measures for the variables in the dataset used for the analyses.

-   Histograms were created to illustrate the distribution of the outcomes visually.

-   Stratified box-plots were created to visualize the distribution of the measures of the different types of stress (Chronic, Acute, Perceived) across the different pregnancy outcomes. The following observations were made:

#### Summary Statistics Table

```{r echo=FALSE}
tableone<-pregnancy_data|>dplyr::select(pregnancy, Acute_stress, Chronic_Stress, Perceived_stress, mental_illness, Age)|>
tbl_summary(
    type = all_continuous() ~ "continuous2",
    statistic = list(
      all_continuous() ~ c("{mean}, {median}, {sd}"," {min}, {max}", "({p25} {p75})"),
      all_categorical() ~ c("{n}, {p}% {N_miss}")
    )
  ) |>
  modify_header(label ~ "**Variable**") |>
  modify_caption("**Table 1. Summary Statistics**") |>
  bold_labels()
```

#### Data Visualizations

```{r echo=FALSE}

# Histogram for Chronic Stress
a1 <- pregnancy_data |> ggplot(aes(Chronic_Stress)) + 
  geom_histogram(color="blue", fill="lightblue", bins=12) +  
  labs(
    x = "Chronic Stress",
    y = "Count"
  ) + 
  theme_bw() 
# Histogram for Acute Stress
a2 <- pregnancy_data |> ggplot(aes(Acute_stress)) + 
  geom_histogram(color="darkgreen", fill="lightgreen", bins=12) +  
  labs(
    x = "Acute Stress",
    y = "Count"
  ) + 
  theme_bw() 
  

# Histogram for Perceived Stress
a3 <- pregnancy_data |> ggplot(aes(Perceived_stress)) + 
  geom_histogram(color="darkred", fill="salmon", bins=12) +  
  labs(
    x = "Perceived Stress",
    y = "Count"
  ) + 
  theme_bw()

```

```{r echo=FALSE}

# Chronic stress and Pregnancy outcome

b1<-pregnancy_data|>ggplot(aes(pregnancy,Chronic_Stress, fill = pregnancy)) +
  geom_boxplot() +
  scale_fill_manual(values = c("chocolate2", "darkslategrey", "hotpink")) +
  theme_bw() + labs(x="Pregnancy outcome", title = "Boxplot of Chronic stress by Pregnancy Outcome")


b2<-pregnancy_data|>ggplot(aes(pregnancy,Acute_stress, fill = pregnancy)) +
  geom_boxplot() +
  scale_fill_manual(values = c("turquoise", "linen", "sienna")) + theme_bw() + labs(x="Pregnancy outcome", title = "Boxplot of Acute stress by Pregnancy Outcome")

b3<-pregnancy_data|>ggplot(aes(pregnancy,Perceived_stress, fill = pregnancy)) +
  geom_boxplot() +
  scale_fill_manual(values = c("seashell", "magenta", "#2ecc71")) +
  theme_bw() + labs(x="Pregnancy outcome", title = "Boxplot of Percieved stress by Pregnancy Outcome")

```

## Statistical Analysis

The aim of this project was to investigate the associations between pregnancy outcomes after IVF and three types of stress for a population of infertile women, adjusting for age and history of mental illness. To explore this aim, we proposed three scientific objectives. For each objective, we fitted multiple binary logistic regression models of the form:

$Log(odds(Y_i))=\beta_0 + \beta_1X_{i1} + \beta_2Age + \beta_3I_{History=1}$

Where:

-   $Y_i$ is the outcome of interest, a binary variable with values of 1 representing successful pregnancy, and 0 representing unsuccessful pregnancy.

-   $X_{i1}$ is the predictor of interest, and for each objective represents the measure of the respective stress type.

-   The parameters $\beta_0, \beta_1, \beta_2, \beta_3$ are unknown and estimated by the method of maximum likelihood.

-   $\beta_1$ is the parameter of interest and is interpreted as the difference in log odds of successful pregnancy between two subpopulations of infertile women of the same age and with the same mental illness history that differ in their respective stress measure by 1 unit. The estimated parameter will be interpreted on the odds ratio scale.

-   $I_{History=1}$ is an indicator variable for history of mental illness, where 1 represents presence of history and 0 represents absence.

-   We evaluated statistical evidence by conducting multiple hypothesis tests using the Wald test. For each objective, we tested the following hypotheses:

    -   $H_0: \beta_1 = 0$ (Null hypothesis: There is no association between pregnancy outcome and the stress type, adjusting for age and history of mental illness.)

    -   $H_1: \beta_1 \neq 0$ (Alternative hypothesis: There is an association between pregnancy outcome and the stress type, adjusting for age and history of mental illness.)

-   To avoid overfitting and ensure generalizability, we limited the number of predictors in the model. Using the rule of thumb to have no more than $n * p_{min}/15$ predictors, where $n$ is the sample size and $p_{min}$ is the proportion of the less frequent outcome. Hence, our model had 3 predictor variables with the stress type being the predictor of interest for each of the models.

**Model Diagnostics**

The validity of regression coefficient estimates, confidence intervals, and significance tests relies on these assumptions: binary outcomes, independence of observations, large sample size, and linearity in the logit. Outliers, influential observations, and multicollinearity were also investigated as these influence the regression coefficients and validity of the model.

-   **Binary outcomes**: This assumption was met as our outcome variable (pregnancy success) was dichotomous.

-   **Independence of observations**: This assumption was satisfied as there were no repeated measurements for the participants in the study.

-   **Large sample size**: Logistic regression requires a large sample size, with a general rule of thumb being a minimum of 10 cases per predictor variable. Our analysis met this assumption, as there were more than 50 cases per variable.

-   **Linearity in the logit**: This assumption requires the predictor variables to be linearly related to the log odds of the response variable. We assessed this using marginal model plots, where the response variable is plotted against each predictor variable.

-   **Outliers and influential observations**: We assessed these in the diagnostic checking section, performing tests for outliers and using various influence measures such as studentized residuals, Cook's distance and leverage statistics.

-   **Multicollinearity:** This assumptions requires the predictor variables to not be highly correlated with each other, and was diagnosed with the variance inflation factor.

# Results

## Exploratory Data Analysis

::: {layout-ncol="2"}
::: column
### Summary Statistics Table

```{r}
#| results: asis
tableone
```
:::
:::

### Histograms

::: {layout-ncol="3"}
::: column
#### Histogram for Chronic Stress

```{r}
#| results: asis
a1
```
:::

::: column
#### Histogram for Acute Stress

```{r}
#| results: asis
a2
```
:::

::: column
#### Histogram for Percieved Stress

```{r}
#| results: asis
a3
```
:::
:::

### Boxplots

::: {layout-ncol="3"}
::: column
#### Chronic stress and Pregnancy outcome

```{r}
#| results: asis
b1
```
:::

::: column
#### Acute stress and Pregnancy outcome

```{r}
#| results: asis
b2
```
:::

::: column
#### Percieved stress and Pregnancy outcome

```{r}
#| results: asis
b3
```
:::
:::

## Fitted Models

```{r echo=FALSE}
model1<-glm(pregnancy~Chronic_Stress+Age+as.factor(mental_illness), data=ivf_data,family = "binomial")
model2<-glm(pregnancy~Acute_stress+Age+as.factor(mental_illness), data=ivf_data,family = "binomial")
model3<-glm(pregnancy~Perceived_stress+Age+as.factor(mental_illness), data=ivf_data,family = "binomial")
```

### Logisitc Regression Model Results

::: {layout-ncol="2"}
::: column
#### Model 1: Chronic Stress

```{r}
#| results: asis
tab_model(model1)
```
:::

::: column
#### Model 2: Acute Stress

```{r}
#| results: asis
tab_model(model2)
```
:::

::: column
#### Model 3: Percieved Stress

```{r}
#| results: asis
tab_model(model3)
```
:::
:::

# Discussion

This project aimed to investigate the associations between specific types of stress (Acute, Chronic, and Perceived) and the outcome of pregnancy after In Vitro fertilization treatment for a population of infertile women. The data utilized for this project was obtained from a prospective study with the same objective. Descriptive statistics revealed that the participants ranged from 20 to 45 years old (Mean=31.4, SD=7). Their score on the:

-   **Chronic Stress Measure**: The Social Readjustment Rating Scale (SRRS) ranged from 0 to 499 (Mean=145, SD=109). Seventy-five percent of the participants had SRRS scores of 199 or lower, indicating that most experienced a moderate to the low-stress level.

-   **Acute Stress Measure:** The Spielberger State-Trait Anxiety Inventory (STAI) ranged from 20 to 62 (Mean=39, SD=9). Seventy-five percent of the participants had STAI scores of 45 or lower, indicating no or low to moderate anxiety.

-   **Perceived Stress Measure**: The Perceived Stress Scale (PSS) ranged from 0 to 39 (Mean=15, SD=7). Seventy-five percent of the participants had PSS scores of 19 or lower, indicating low to moderate perceived stress levels.

The majority of the participants had no history of mental illness (96%) and had a successful pregnancy (72%).

Our analysis of the stratified boxplots, which show the distribution of stress measures for each pregnancy outcome, revealed some interesting findings. While the median SRRS and STAI scores were similar for successful and unsuccessful pregnancies, the PSS median score was notably higher for successful pregnancies than unsuccessful ones.

We fitted three binary logistic regression models to explore the objectives in greater detail. To investigate these associations, we estimated the odds of a successful pregnancy given the predictor of interest for each model, adjusting for potential confounders. After adjusting for Age and the history of mental illness, our findings revealed that:

-   Perceived stress was significantly positively associated with pregnancy outcome (Adjusted Odds Ratio \[AOR\] = 1.05; 95% Confidence Interval \[CI\]: 1.00-1.11; p =0.05). Participants with perceived stress measured by the Perceived Stress Scale (PSS) had 1.05 times the odds of a successful pregnancy.

-   The Chronic and Acute Stress models yielded non-significant findings for these predictors of interest.

We conducted diagnostic tests to check for violations of model assumptions and found that our models did not violate the absence of multicollinearity or independence assumptions. There were no highly influential observations, although some observations had high leverage. However, we identified a violation of the Linearity assumption for Model 1 (Chronic Stress as Predictor of Interest) and Model 3 (Perceived Stress as Predictor of Interest). To address this violation, we applied non-linear transformations:

-   For Model 1, we included a quadratic term for the Chronic Stress and Age variables.

-   For Model 3, we fitted a natural spline with two degrees of freedom for the Perceived Stress variable.

We implemented Analysis of Variance (ANOVA) to assess if adding the quadratic term to Model 1 and the natural spline to Model 3 improved the fit. From the results, we concluded that:

-   Adding the quadratic term to the Age and Chronic Stress variables for Model 1 did improve the fit (Pr \> Chi = 0.045).

-   Adding the natural splines to the Perceived Stress variable did not improve the model fit (Pr \> Chi = 0.5).

# Appendix {.appendix}

## Multicollinearity

The following table presents the Variance Inflation Factors (VIF) for the models:

```{r echo=FALSE}
car::vif(model1)
car::vif(model2)
car::vif(model3)
```

## Influence Index Plots

Influence index plots for all models are displayed in the layout below:

::: {layout-ncol="2"}
::: column
### Model 1

```{r fig-influence-a, fig.cap="Influence Index Plot for Model 1"}
#| label: fig-influence-a
car::influenceIndexPlot(model1, vars = c("Studentized", "hat", "Cook"), id = list(n = 3))
```
:::

::: column
### Model 2

```{r fig-influence-b, fig.cap="Influence Index Plot for Model 2"}
#| label: fig-influence-b
car::influenceIndexPlot(model2, vars = c("Studentized", "hat", "Cook"), id = list(n = 3))
```
:::

::: column
### Model 3

```{r fig-influence-c, fig.cap="Influence Index Plot for Model 3"}
#| label: fig-influence-c
car::influenceIndexPlot(model3, vars = c("Studentized", "hat", "Cook"), id = list(n = 3))
```
:::

## CR Plots for Linearity

::: {layout-ncol="2"}
::: column
### Model 1

```{r fig-linearity-a, fig.cap="CR Plot for Model 1"}
#| label: fig-linearity-a
car::crPlots(model1, terms = ~Chronic_Stress+Age,
             pch=20, col="gray",
             smooth = list(smoother=car::gamLine))
```
:::

::: column
### Model 2

```{r fig-linearity-b, fig.cap="CR Plot for Model 2"}
#| label: fig-linearity-b
car::crPlots(model2, terms = ~Acute_stress+Age,
             pch=20, col="gray",
             smooth = list(smoother=car::gamLine))

```
:::

::: column
### Model 3

```{r fig-linearity-c, fig.cap="CR Plot for Model 3"}
#| label: fig-linearity-c
car::crPlots(model3, terms = ~Perceived_stress+Age,
             pch=20, col="gray",
             smooth = list(smoother=car::gamLine))

```
:::
:::

## Outliers

The outlier tests for each model are summarized below:

```{r echo=FALSE}
car::outlierTest(model1)
car::outlierTest(model2) 
car::outlierTest(model3)
```
:::

## Sensitivity Analyses

### Model A

```{r echo=FALSE}
library(splines)
modela<-glm(pregnancy~Chronic_Stress+ I(Chronic_Stress^2)+Age + I(Age^2)+as.factor(mental_illness), data=ivf_data,family = "binomial")
```

#### Fitted models

::: {layout-ncol="2"}
::: column
```{r}
#| results: asis
tab_model(modela)
```
:::
:::

#### Diagnostic Checking

##### Multicollinearity

```{r echo=FALSE}
car::vif(modela)

```

##### Influence Index Plots

::: {layout-ncol="2"} ::: column

```{r fig-influence-1, fig.cap="Influence Index Plot for Model A"}
#| label: fig-influence-1
car::influenceIndexPlot(modela, vars = c("Studentized", "hat", "Cook"), id = list(n = 3))
```

:::

##### CR plots for linearity

::: {layout-ncol="2"}
::: column
```{r fig-linearity-a, fig.cap="CR Plot for Model A"}
#| label: fig-linearity-1

car::crPlots(modela, terms = ~Chronic_Stress+ I(Chronic_Stress^2)+Age + I(Age^2),
             pch=20, col="gray",
             smooth = list(smoother=car::gamLine))

```
:::
:::

##### Outliers

The outlier tests for each model are summarized below:

```{r echo=FALSE}
car::outlierTest(modela)
```

### Model B: Percieved Stress

```{r echo=FALSE}
library(splines)
modelb<-glm(pregnancy~sqrt(Perceived_stress)+Age+as.factor(mental_illness), data=ivf_data,family = "binomial")
```

#### Fitted models

::: {layout-ncol="2"}
::: column
```{r}
#| results: asis
tab_model(modelb)
```
:::
:::

#### Diagnostic Checking

##### Multicollinearity

```{r echo=FALSE}
car::vif(modelb)

```

##### Influence Index Plots

::: {layout-ncol="2"}
::: column
```{r fig-influence-2, fig.cap="Influence Index Plot for Model B"}
#| label: fig-influence-2
car::influenceIndexPlot(modelb, vars = c("Studentized", "hat", "Cook"), id = list(n = 3))
```
:::

##### CR plots for linearity

::: {layout-ncol="2"}
::: column
```{r fig-linearity-b, fig.cap="CR Plot for Model B"}
#| label: fig-linearity-2

car::crPlots(modelb, terms = ~sqrt(Perceived_stress),
             pch=20, col="gray",
             smooth = list(smoother=car::gamLine))

```
:::
:::

##### Outliers

The outlier tests for each model are summarized below:

```{r echo=FALSE}
car::outlierTest(modelb)
```
:::

#### Anova Results

```{r echo=FALSE}
anova(model1, modela)
anova(model3, modelb)
```
