---
title: "Longitudinal Analysis"
author: "Obehi Winnifred Ikpea"
format: html
editor: visual
---

```{r echo=FALSE}
# Load necessary libraries
library(broom)        # tidy up models
library(broom.mixed)  # tidy up mixed models
library(car)          # useful for anova/wald test
library(DHARMa)       # residual diagnostics for hierarchical models
library(emmeans)      # marginal means
library(Epi)          # easy getting CI for model coef/pred
library(geepack)      # generalized estimating equations
library(ggpubr)       # convenient summary statistics and plots
library(GGally)       # advanced plot
library(ggeffects)    # marginal effects, adjusted predictions
library(gt)           # nice tables
library(gtsummary)    # another package for nice tables
library(kableExtra)   # format tables
library(knitr)        # dynamic report generation
library(labelled)     # labeling data
library(lme4)         # linear mixed-effects models
library(lmerTest)     # test for linear mixed-effects models
library(lvmisc)       # miscellaneous utilities for linear models
library(multcomp)     # CI for linear combinations of model coef
library(multilevelTools)  # tools for multilevel models
library(readr)        # read data
library(redres)       # residual diagnostics for regression models
library(rstatix)      # summary statistics
library(sjPlot)       # plotting models
library(tidyverse)    # for everything (data manipulation, visualization, coding, and more)

# Set a consistent ggplot theme
theme_set(theme_bw() + theme(legend.position = "bottom"))

# Load the data
framingham <- read_csv("framingham (2).csv")
mcrf <- read_csv("mcrf (1).csv")

```

# Introduction

# Methods

## Data Description

The data for this project was collected from the Muscatine Coronary Risk Factor (MCRF) study, a longitudinal survey of 4856 school-age children in Muscatine, Iowa. The study aimed to investigate the development and persistence of risk factors for coronary disease in children. The study measured the weights and heights of five different cohorts of children, initially aged 5-7, 7-9, 9-11, 11-13, and 13-15 years, every two years from 1977 to 1981. Children were classified as obese or not obese based on a comparison of their weight to age-gender-specific norms.

#### Variables Description

The data consists of 6 variables namely:

-   id: participant ID

-   sex: sex at birth (0=Male,1=Female)

-   b_age: Baseline Age

-   age: Current Age

-   visit: visit number

-   obesity: Obesity Status (1=Obese, 0=Non-Obese, .=Missing)

```{r echo=FALSE}
kable(head(mcrf), caption = "Table: First 6 Rows of Data")
```

## Data Preparation

The data was tidied to ensure completeness and correctness. This involved:

1.  Recoding the obesity value with '.' to NA, and then dropping the missing values.

The new dataset consists of 9856 observations and 6 variables.

```{r echo=FALSE}
mcrf_new<-mcrf|>mutate(obesity=na_if(obesity, '.'))|>drop_na()
mcrf_new<-mcrf_new|>mutate_at(vars(obesity, sex, id, b_age, age, visit), as.numeric)|>mutate(year=visit-1)
kable(head(mcrf_new), caption = "Table: First 6 Rows of Data")

```

## Exploratory Data Analysis

```{r echo=FALSE}
tabletwo<-mcrf_new|>select(sex,age,obesity,year)|>
tbl_summary(
  by=sex,
 type=all_continuous() ~ "continuous2",
    statistic = list(
      all_continuous() ~ c("{mean},({p25}, {p75})", "{sd}"), all_categorical() ~ c("{n}, {p}% {N_miss}"))
  )|>modify_header(label ~ "**Variable**")|>
  modify_caption("**Table 2. Baseline Characteristics Summary Statistics")|>
  bold_labels()

tabletwo
```

```{r echo=FALSE}
summary_tab1 <- mcrf_new|> 
  summarize(nobs = n(),
            nobese = sum(obesity),
            percent_obesity = mean(obesity), .by=c(sex,visit))

summary_tab1$sex <- factor(summary_tab1$sex)
levels(summary_tab1$sex) <- c("Male", "Female")
visit_year<-c(0,1,2)
summary_tab1$visit_year<-visit_year[summary_tab1$visit]

summary_tab1

ggplot(summary_tab1, aes(x=visit_year, y=percent_obesity*100, group=sex)) +
  geom_line(aes(color=sex, linetype=sex), linewidth=1.2) + 
  theme_bw()  + ylim(c(0,30)) + 
  xlab("Time (year)") + scale_color_manual(values = pal2use) +
  theme(legend.position = "bottom") + ylab("% Obesity") + scale_x_continuous(breaks=seq(0,2,1))
```

## Statistical Analysis

# Results

# Discussion
